<!DOCTYPE html>
<html lang="en">
<head>
	<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:20px;}
  .instruction{margin-bottom:20px;padding:15px;border:1px solid #ddd;border-radius:5px;}
  .instruction h2{margin:0 0 10px;font-size:1.2em;}
  .instruction p{margin:0;}
  hr{border:none;border-top:1px solid #eee;margin:30px 0;}
</style>
</head>
<body>
    <h1>Loaded from API</h1>

<div id="instructions"></div>
	<script>
    // Function to get the value of a specific query parameter by name
	async function loadInstructions() {
		try {
			// Get the full query string from the URL
			const queryString = window.location.search;
			// Use URLSearchParams to parse the query string
			const urlParams = new URLSearchParams(queryString);
			// Return the value of the specified parameter
			const group =  urlParams.get('group');
			
			// Define the authentication token
			const authToken = '5fe704861ce1cdca3d0de625d7671de3e1ae80c783e6763b5e50febaa87776fd';
			// Define the request body
			const requestBody = {
				group_encoded: group
			};
	
			let  response = await fetch('https://apim.workato.com/bostons/test-tatiana-brat-v1/database', {
			  method: 'POST',
			  headers: {
				'Content-Type': 'application/json',
				'Accept': 'application/json', 
				'API-TOKEN': authToken
			  },
			  body: JSON.stringify(requestBody)
			});			
			const rawData = await response.json();
			document.write('Full Response:',JSON.stringify( rawData.database, null, 4));
						
			/* 1. Определяем, что нам передали */
  
			let dataArray = [];
			if (Array.isArray(rawData.database)) {
			  // если пришёл массив, используем его напрямую
			  dataArray = rawData.database;
			} else if (rawData && typeof rawData === 'object') {
			  // если пришёл один объект, но он может содержать массив внутри
			  if (Array.isArray(rawData.database)) {
				dataArray = rawData.database;
			  } else {
				// если пришёл один объект‑инструкция
				dataArray = [rawData];
			  }
			}
			if (response.status === 200) {
							const container = document.getElementById('instructions');
							/* 1. Определяем, что нам передали */

							
							dataArray.forEach((item, idx) => {
							  const div = document.createElement('div');
							  div.className = 'instruction';

							  const name = item.instruction_item?.instruction_name ?? 'instruction ${idx+1}';
							  const text = item.instruction_item?.instruction ?? 'Not found';

							  div.innerHTML = '<h2>${name}</h2><p>${text}</p>';
							  container.appendChild(div);

							  if (idx < dataArray.length - 1) {
								container.appendChild(document.createElement('hr'));
							  }
							});
							// Log the full response to understand its structure
							//document.write('Full Response:',JSON.stringify( answer.database, null, 4));
						
						  
						}
	} catch (error2) {
                 console.error(error2);
				document.getElementById('instructions').innerText = 'Failed to upload data.';
            }}
	document.addEventListener('DOMContentLoaded', loadInstructions);
</script>
</body>
</html>
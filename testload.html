<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Инструкции из API</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:20px;}
  .instruction{margin-bottom:20px;padding:15px;border:1px solid #ddd;border-radius:5px;}
  .instruction h2{margin:0 0 10px;font-size:1.2em;}
  .instruction p{margin:0;}
  hr{border:none;border-top:1px solid #eee;margin:30px 0;}
</style>
</head>
<body>

<h1>Инструкции из API</h1>
<div id="instructions"></div>

<!-- Скрипт подключён с defer, чтобы он ждёт построения DOM -->
<script defer>
async function loadInstructions() {
  try {
		// Get the full query string from the URL
			const queryString = window.location.search;
			// Use URLSearchParams to parse the query string
			const urlParams = new URLSearchParams(queryString);
			// Return the value of the specified parameter
			const group =  urlParams.get('group');
			
			// Define the authentication token
			const authToken = '5fe704861ce1cdca3d0de625d7671de3e1ae80c783e6763b5e50febaa87776fd';
			// Define the request body
			const requestBody = {
				group_encoded: group
			};
	
			let  response = await fetch('https://apim.workato.com/bostons/test-tatiana-brat-v1/database', {
			  method: 'POST',
			  headers: {
				'Content-Type': 'application/json',
				'Accept': 'application/json', 
				'API-TOKEN': authToken
			  },
			  body: JSON.stringify(requestBody)
			});	
  
  
    if (!response.ok) throw new Error(`Ошибка сети: ${response.status}`);
    const rawData = await response.json();

    /* ---------- 1. Нормализация результата в массив ---------- */
    let instructions = [];

    if (Array.isArray(rawData)) {
      instructions = rawData;
    } else if (rawData && typeof rawData === 'object') {
      if (Array.isArray(rawData.database)) {
        instructions = rawData.database;
      } else if (rawData.database && typeof rawData.database === 'object') {
        instructions = [rawData.database];
      } else {
        instructions = [rawData];
      }
    }

    if (!Array.isArray(instructions)) {
      throw new Error('Получены данные не в виде массива инструкций');
    }

    /* ---------- 2. Вывод инструкций ---------- */
    const container = document.getElementById('instructions');
    instructions.forEach((item, idx) => {
      const name = item.instruction_name ||
                   item.instruction_item?.instruction_name ||
                   `Инструкция ${idx + 1}`;
      const text = item.instruction ||
                   item.instruction_item?.instruction ||
                   'Текст не найден';

      const div = document.createElement('div');
      div.className = 'instruction';
      div.innerHTML = `<h2>${name}</h2><p>${text}</p>`;
      container.appendChild(div);

      if (idx < instructions.length - 1) {
        container.appendChild(document.createElement('hr'));
      }
    });

  } catch (err) {
    console.error(err);
    document.getElementById('instructions')
            .innerText = 'Не удалось загрузить данные. Проверьте URL или формат ответа.';
  }
}

document.addEventListener('DOMContentLoaded', loadInstructions);
</script>

</body>
</html>
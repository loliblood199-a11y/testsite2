<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Call with Authentication and Redirect</title>
    <script>
        async function fetchDataAndRedirect() {
            try {
				// Get the full URL of the current page
				const url = window.location.href;

				// Create a URL object
				const urlObj = new URL(url);

				// Use URLSearchParams to get the query parameters
				const params = new URLSearchParams(urlObj.search);

				// Get the 'user_id' parameter
				const userId = params.get('user_id');

				// Log the user_id to the console
				document.write('User ID:', userId);

                // Define the authentication token
                const authToken = 'fb0004f9bf12a67319c68b4743442c788dc5ad6051e1d74ca60a144515f60dbe';
                // Define the request body
                const requestBody = {
                    user_id: userId
                };
                
				// Log the request body for debugging
                document.write('Request Body:', requestBody);
				const response = await fetch('https://apim.workato.com/bostons/test-tatiana-brat-v1/auth', {
				  method: 'POST',
				  headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json', 
					'API-TOKEN': authToken
				  },
				  body: JSON.stringify(requestBody)
				});
				// Log the response status for debugging
                console.log('Response Status:', response.status);
				document.write('Response Status:', response.status)
                // Check if the response status is 200
                /*if (response.status === 200) {
                    // Redirect to www.google.com
                    window.location.href = 'https://loliblood199-a11y.github.io/testsite2/testload.html';
                }*/
				if (response.status === 200) {
					// Extract the value you need from the response
					// For example, let's assume the value is in response.data.someValue
					const someValue = response.data.someValue;

					// Construct the URL with the hidden parameter
					const redirectUrl = `https://loliblood199-a11y.github.io/testsite2/testload.html?hiddenParam=${encodeURIComponent(someValue)}`;

					// Redirect to the constructed URL
					window.location.href = redirectUrl;
				}				
				else {
                    // Log the response text for debugging
                    const errorText = await response.text();
                    console.error('Error Response:', errorText);
                    throw new Error('Network response was not ok');
                }

			
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        } 
		fetchDataAndRedirect();
        // Call the function when the page loads
    </script>
</head>
<body>
    <h1>Loading...</h1>
</body>
</html>